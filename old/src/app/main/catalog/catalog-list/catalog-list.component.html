<div id="masonry" class="masonry">
  <app-mockup-catalog-list
    class="catalog-list"
    *ngIf="users == undefined"
  ></app-mockup-catalog-list>
  <div class="masonry__sizer"></div>
  <div class="masonry__gutter"></div>
  <div
    class="masonry__card"
    *ngFor="let user of users | async | sort: 'is_online'; let index = index"
  >
    <!-- card -->
    <div class="card" *ngIf="user.last_feed" [class.active]="index === activeCard">
      <div class="card__header">
        <div class="flex-shrink-0">
          <a [routerLink]="['detail', user?.id]" class="card__avatar">
            <app-user-item
              [photo]="user.main_photo"
              [isOnline]="user.is_online"
              [cam]="user.is_camera"
            ></app-user-item>
          </a>
        </div>
        <div class="text-muted mx-2 overflow-hidden">
          <div class="text-truncate font--size-14 card__user-main-info">
            <a [routerLink]="['detail', user.id]" class="text-dark font-weight-bold"
              >{{ user.username }},</a
            >
            <span class="font-weight-bold card__age"> {{ user.age }}</span>
          </div>
          <div class="d-flex align-items-center card__user-from">
            <img src="/assets/icons/svg-icons/location-black.svg" class="mr-1" />
            <span class="text-truncate">{{ user.city }}, {{ user.country_string }}</span>
          </div>
        </div>
        <img src="/assets/icons/svg-icons/verified.svg" *ngIf="user.is_verified" class="mr-3" />
        <img
          src="/assets/icons/svg-icons/not-verified.svg"
          *ngIf="!user.is_verified"
          class="mr-3"
        />
        <img
          src="/assets/icons/svg-icons/half-verified.svg"
          *ngIf="user.is_verified === 'half'"
          class="mr-3"
        />
        <!--<button
          class="btn btn-outline-primary btn-sm btn-rounded ml-auto flex-shrink-0 card__subscribe-btn"
          *ngIf="!user.is_subscribed"
          (click)="emitSubscribe(user)"
        >
          + Subscribe
        </button>-->
        <!--
        <button
          (click)="emitUnSubscribe(user)"
          href="#"
          *ngIf="user.is_subscribed"
          class="btn btn-outline-primary btn-sm btn-rounded ml-auto flex-shrink-0 card__subscribe-btn"
        >
          Unsubscribe
        </button>
        -->
      </div>
      <div class="card__body none-select" (click)="emitOpenPopup(user.last_feed.id)">
        <img
          class="card__body-main-image"
          [src]="user.last_feed.main_media?.middle_main_image_url"
        />
        <div class="card__hover">
          <img src="/assets/icons/svg-icons/zoom.svg" alt="Zoom" />
        </div>
        <div class="card__label">
          <div *ngIf="user.last_feed.count_video + user.last_feed.count_photo == 1">
            <img
              *ngIf="user.last_feed.main_media?.type_media == 'video'"
              src="/assets/icons/svg-icons/video-camera-white.svg"
              alt="Video"
              class="icon icon--size-14"
            />

            <img
              *ngIf="user.last_feed.main_media?.type_media == 'photo'"
              src="/assets/icons/svg-icons/photo.svg"
              alt="Photo"
              class="icon icon--size-14"
            />
          </div>
          <div *ngIf="user.last_feed.count_video + user.last_feed.count_photo > 1">
            <img src="/assets/icons/svg-icons/gallary.svg" alt="Video" class="icon icon--size-20" />

            <span class="counter">{{
              user.last_feed.count_video + user.last_feed.count_photo
            }}</span>
          </div>
        </div>
        <div
          class="card__duration flex align-items-center"
          *ngIf="user.last_feed.main_media?.type_media == 'video'"
        >
          <img src="/assets/icons/svg-icons/chart-volume.svg" alt="Video duration" />
          <span class="card__duration-text">{{
            formatVideoTime(user.last_feed.main_media.duration)
          }}</span>
        </div>
      </div>

      <div class="card__footer flex flex-column align-items-start">
        <span class="flex-shrink-0 card__date">{{
          user.last_feed.created_at ? user.last_feed.created_at.split('-').join('.') : ''
        }}</span>
        <span class="text-truncate card__title">
          {{ user.last_feed.title }}
        </span>
        <span class="card__hashtags">#libra #horoscope #scorpio</span>
        <div class="d-flex justify-content-between full-width">
          <div class="d-flex align-items-center">
            <img class="mr-1" src="/assets/icons/svg-icons/geo.svg" alt="Geo" /><span
              class="card__geo"
              >{{ user.last_feed.location || '' }}
            </span>
          </div>
          <div class="flex">
            <div class="card__footer-icon hoverable">
              <app-like
                [isLiked]="user.last_feed.is_liked"
                (emitClick)="handleClickLike(user)"
              ></app-like>
            </div>
            <button class="card__footer-icon hoverable">
              <img
                src="/assets/icons/svg-icons/comment.svg"
                alt="Comment"
                (click)="emitOpenPopup(user.last_feed.id)"
              />
            </button>
            <button class="card__footer-icon hoverable">
              <img
                src="/assets/icons/svg-icons/send-message.svg"
                alt="Send message"
                (click)="emitCallToChat(user.id)"
              />
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
